#!/bin/bash

[ "$BCH_PH_DROP" = "" ] && cat ${0}.usage
[ "$BCH_PH_DROP" = "" ] && cat ${0}.undefined
[ "$BCH_PH_DROP" = "" ] && exit

export_ () { export $1="$2"; }

unknown () {
    echo $(basename $0): unknown subcommand: [$1]
    echo try "'-h'"
}

jot () {
    dt4     () { echo $(date "+%Y-%m-%d-T-%H:%M:%S"); }
    date4dt () { echo $1 | cut -c 1-4,6-7,9-10; }
    dump () {
        for name in $(/bin/ls ${STASH}/* | sort); do
            echo $(tput bold) ${name} $(tput sgr0)
            cat ${name}
        done
    }
    export_ dt      $(dt4)
    export_ file    ${STASH}/$(date4dt $dt)T.zjot
    export_ f0      "${dt}"
    export_ f1      "${*}"
    touch $file
    dump
    echo
    read -p "${f0} ${f1} ... " f2
    echo
    echo "$f0 $f1 $f2" >> $file
    dump
}

main () {
    export_ STASH   ${BCH_PH_DROP}/zjot
    mkdir -p ${STASH}
    case .$1 in
        .--jot   )  shift;  jot $* ;;
        .--stash )  echo ${STASH} ;;
        .--list  )  ls ${STASH}  ;;
        .--help  )  cat ${0}.usage ;;
        .-h      )  cat ${0}.usage ;;
        .        )  cat ${0}.usage ;;
        *        )  unknown $* ;;
    esac
}

main $*
